#include "SStrafeGuardCycle.sp"

SStrafeGuardCycle   StrafeGuardCycle[MAXPLAYERS];

enum struct SStrafeGuard
{
	////////////////////////////////////////////////////////////////////////////////////////////////////
	//вкл/выкл (по умолчаню включен)
	bool 			EnabeStrafeGuard;
	////////////////////////////////////////////////////////////////////////////////////////////////////

	////////////////////////////////////////////////////////////////////////////////////////////////////
	void
	Start()
	{
		this.EnabeStrafeGuard = true;

		//конект всех игроков при загрузке плагина
		for(int i = 0 ; i < MAXPLAYERS ; i++)
			if(IsValidClient(i))
				this.ConnectPlayer(i);
	}
	////////////////////////////////////////////////////////////////////////////////////////////////////

	////////////////////////////////////////////////////////////////////////////////////////////////////
	void
	ConnectPlayer(
		int         client)
	{
		//обнуление данных для нового игрока
		if(this.EnabeStrafeGuard)
			StrafeGuardCycle[client].CreateClient(client);
	}
	////////////////////////////////////////////////////////////////////////////////////////////////////

	////////////////////////////////////////////////////////////////////////////////////////////////////
	void
	PlayerRunCmd(
		int         client,
		float       vel[3],
		float       angles[3],
		int         mouse[2],
		int&        buttons)
	{
		if(this.EnabeStrafeGuard)
			StrafeGuardCycle[client].PlayerRunCmd(vel,angles,mouse,buttons); 
	}
	////////////////////////////////////////////////////////////////////////////////////////////////////

	////////////////////////////////////////////////////////////////////////////////////////////////////
	void 
	Client_StrafeCheck(
		SCmd        Cmd)
	{
		int         target;

		if(this.EnabeStrafeGuard)
		{
			if(Cmd.GetTarget(target))
			{
				if(StrafeGuardCycle[target].showstats)
					StrafeGuardCycle[target].showstats = false;
				else
					StrafeGuardCycle[target].showstats = true;

				PrintToChat(Cmd.GetClient(),"ShowStats for %N is %s",
					target, StrafeGuardCycle[target].showstats ? "ENABLE":"DISABLE");          
			}      
		}
	}
	////////////////////////////////////////////////////////////////////////////////////////////////////
	
	////////////////////////////////////////////////////////////////////////////////////////////////////
	void 
	Cmd_StrafeGuard(
		SCmd        Cmd)
	{
		int         EnabeStrafeGuard;
		bool 		LastStage = this.EnabeStrafeGuard;

		if(Cmd.GetArgHowInt(1,EnabeStrafeGuard))
		{
			if(EnabeStrafeGuard)
				this.EnabeStrafeGuard = true;
			else
				this.EnabeStrafeGuard = false;

			PrintToChat(Cmd.GetClient(),"StrafeGuard is %s",
				EnabeStrafeGuard ? "ENABLE":"DISABLE");     

			if(this.EnabeStrafeGuard && !LastStage)    
				this.Start();	
		}      
	}
	////////////////////////////////////////////////////////////////////////////////////////////////////
}